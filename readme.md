# Dirt Cache Registry Prototype

## Run
1. Unzip node_modules.zip
2. cd /src
3. Edit the last line of server.js to switch between running tests or the server
4. node server

# Design Decisions
## Registries
- All Registries, at the root level and excluding their items, are loaded directly into the memory and never invalidated.
- Registry's address is used as its unique key.

## Registry items
- Redis is used to cache registry items.
- When a registry's items are requested, if they are not cached, the cache reads items from DIRT client and stores them in Redis.
- If a registry's items are cached, read them from Redis.
- Each item in Redis has a unique key generated by combining item's origin (Registry address) + item's key.
- Items stored as raw strings generated by stringifying the item's JSON object. 
- Two cache invalidation strategies are implemented:
    
    - LRU is implemented using a linked list which updates accessed records in O(1) and returns the least recently used item in O(1)
    - Time-based is impelmented using a simple timer for each registry.
    - A lock is used to ensure that reading a registry's items and invalidating it are mutually exclusive.

# Remaining Improvements
- Update the list of top-level registries periodically or according to certain events.
- Cache size should count items in Redis, not number of cached registries.
when caching a registry in getRegistryItems, do not access it. use the in-memory data.
- Improve consistency and race condition management.
- Improve error handling
- Improve input sanitazion
- Improve documentation

# Limitations
- Current implementation is limited to a single server. However, it can be easily extended to support multiple cache servers working with one Redis server.

# Issues
- 'Amount Staked' is missing in the results.
